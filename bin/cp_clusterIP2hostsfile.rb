#!/usr/bin/env ruby

require 'rubygems'
require 'checkpoint/network_object'

$stdout.sync
network_objects_file = ARGV[0]

unless network_objects_file
  puts "Usage: #{File.basename(__FILE__)} [NETWORK_OBJECTS_FILE] {ObjectGroup}"
  puts "  ObjectGroup in: Group Host Network... (default: Group)"
  exit
end

ipdb = Hash.new
network_objects = Checkpoint::NetworkObject::Handler.load(network_objects_file)
network_objects.objects.each_pair do |name, obj|
  next unless obj.is_a? Checkpoint::NetworkObject::GatewayCluster
  obj.interfaces.each do |ifobject|
    ip = ifobject.my_ipaddress.to_s
    hostname = obj.name
    ifdevname = ifobject.name
    ipdb[IPAddr.new(ip).to_i] = "#{hostname}_#{ifdevname}"
  end
end

puts "# Generated by #{$0} @ #{Time.now.strftime("%Y%m%d %T")}"
ipdb.keys.sort.each do |intip|
  puts "#{IPAddr.new(intip, Socket::AF_INET).to_s.ljust(20)} #{ipdb[intip]}"
end

